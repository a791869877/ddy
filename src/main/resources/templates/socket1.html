<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"></meta>
    <title>Title</title>
</head>
<body>

<input type="userId" id="userId" hidden="true" th:value="${userId}" />

<form action="" id="saveform">
    用户名<input type="text" name="message" id="message" /> <span id="span"></span>
    <input
            type="button" id="btn"  name="提交啊" onclick="tijiao()"/>
</form>
<script type="text/javascript">


    function tijiao() {
        //绑定事件
            //发送异步请求
            $.ajax({
                type : 'post',
                url : '/system/socket/push/1',
                //发送表单数据到后台
                data : $("#saveform").serialize(),
                success : function(msg) {
                    socket.send("12312313");
                    if (msg.indexOf("ok") != -1) {
                        $("#span") .html("<font color ='green'>用户名可以使用</font>")
                    } else {
                        $("#span") .html("<font color ='red'>用户名重复</font>")
                    }

                }
            })
    }
</script>
</body>
<script type="text/javascript">
    var socket;
    var userid;
    if (typeof (WebSocket) == "undefined") {
        console.log("遗憾：您的浏览器不支持WebSocket");
    } else {
        console.log("恭喜：您的浏览器支持WebSocket");
        //实现化WebSocket对象
        //指定要连接的服务器地址与端口建立连接
        //注意ws、wss使用不同的端口。我使用自签名的证书测试，
        //无法使用wss，浏览器打开WebSocket时报错
        //ws对应http、wss对应https。
        socket = new WebSocket("ws://localhost:8885/websocket/2");
        //连接打开事件
        socket.onopen = function() {
            console.log("Socket 已打开");
            socket.send("消息发送测试(From Client)");
        };
        //收到消息事件
        socket.onmessage = function(msg) {
            $("#messageId").append(msg.data+ "\n");
            console.log(msg.data  );
        };
        //连接关闭事件
        socket.onclose = function() {
            console.log("Socket已关闭");
        };
        //发生了错误事件
        socket.onerror = function() {
            alert("Socket发生了错误");
        }
        //窗口关闭时，关闭连接
        window.unload=function() {
            socket.close();
        };
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="http://www.veryhuo.com/uploads/Common/js/jQuery.md5.js"></script>
</html>